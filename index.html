<!DOCTYPE html>
<html area="sea" device="pc" mi18n-lang="zh-tw" sea-lang="false"
  style="font-size: 58.7037px; height: 100%; overflow: hidden;">

<head>
  <title>原神回歸時間計算</title>
  <link rel="manifest" href="manifest.json">
  <link id="icon" rel="shortcut icon" href="https://genshin.hoyoverse.com/favicon.ico">
  <link rel="stylesheet" href="https://act.hoyoverse.com/ys/event/e20240413preview-pvtga2/styles_7654e533d9a302126101.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
  <style>
    @font-face {
      font-family: font;
      src: url("https://act.hoyoverse.com/ys/event/survey-collection/fonts/default.4b9a2491.ttf"),
        url("https://act-webstatic.hoyoverse.com/font_generate/m20240402hy38ctieps_hk4e_global_zh-tw_7qqgft.woff2"),
        url("https://act-webstatic.hoyoverse.com/font_generate/m20240402hy38ctieps_hk4e_global_zh-tw_7qqgft.woff");
    }

    @media (prefers-color-scheme: dark) {
      html, body {
        background-color: #0c0f1d;
        color: white;
      }
    }

    @media only screen and (orientation: portrait) {
      body {
        transform: rotate(90deg);
        transform-origin: bottom left;
        width: 100vh;
        height: 80vw;
        overflow-x: hidden;
        position: fixed;
        bottom: 100%;
      }
    }

    body .src-components-hippo-modals-Reward-__index_---container---zjR_sr .src-components-hippo-modals-Reward-__index_---ys-preview-switch_f4ot7---ggW1uf .src-components-hippo-modals-Reward-__index_---h_941632148---bSTMA9 .src-components-hippo-modals-Reward-__index_---h_941631726---cMyhLW {
      background-color: #4986bf;
      color: #fafaea;
      font-size: x-large;
      text-decoration: none;
      width: fit-content;
      height: fit-content;
      border-radius: 0 20px;
      padding: .25em 1.5em;
    }
  </style>
</head>

<body onload="startTime()">
  <div class="src-components-hippo-modals-Reward-__index_---container---zjR_sr">
    <div class="src-components-hippo-modals-Reward-__index_---ys-preview-switch_f4ot7---ggW1uf">
      <div class="src-components-hippo-modals-Reward-__index_---h_941632148---bSTMA9 self-font">
        <div class="src-components-hippo-modals-Reward-__index_---h_94163605---q029wX" style="user-select: text!important;">
          觸發條件：冒險等階10級以上、14天以上未登入遊戲且45天以上未觸發「星之歸還」</div>
        <div class="src-components-hippo-modals-Reward-__index_---h_941631471---Fwl8Ur" style="user-select: text!important;">
          <a href="https://github.com/twjmy" target="_blank">作者<i class="fa-brands fa-fw fa-github"></i>twjmy</a> 媒體資源皆取自
          <a href="https://hoyo.link/dBOiFLAL" target="_blank">©原神官方先行展示網頁</a>
        </div>
        <div class="src-components-hippo-modals-Reward-__index_---h_941631976---YeiL8w" style="background-image: none;">
          <div class="src-components-hippo-modals-Reward-__index_---h_94163570---p3KweJ">下次登出時間<br>(31天後)</div>
        </div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163674---_GTw_j" style="user-select: text!important;">🖱️複製後計算<br><font color="red">※觸發時計算看</font>上面</div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163706---qa1M2w">下次回歸時間<br>(45天後)</div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163738---UoBAHO" style="user-select: text!important;">🖱️複製後計算<br><font color="red">※登出時計算看</font><font color="#627a90">下面</font></div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163770---apu1i8"><a href="https://www.hoyolab.com/article/32725526" target="_blank" title="用途?">當前時戳(?)</a></div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163802---DtaAdD" style="user-select: text!important;" contenteditable>⚙️載入中...</div>
        <div class="src-components-hippo-modals-Reward-__index_---h_94163834---lst4oB">📋複製</div>
        <a class="src-components-hippo-modals-Reward-__index_---h_941631726---cMyhLW" href="https://twjmy.github.io/genshin-reunion/">
          回歸時間計算</a>
        <a id="returneeGiftsBtn" class="src-components-hippo-modals-Reward-__index_---h_941631726---cMyhLW" href="#"
          style="font-size:medium;left:6.27rem;padding:.3em .75em;border-radius:5px;color:#fffcdd;background-color:#f78a2d;">
          切換歸途贈禮</a>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
  <script>
    const q = `.src-components-hippo-modals-Reward-__index_---h_`;

    var startTime = async function() {
      while( document.activeElement === document.querySelector(q+`94163802---DtaAdD`)
       || document.activeElement === document.querySelector(q+`94163834---lst4oB`) )
        await new Promise(requestAnimationFrame);
      document.querySelector(q+`94163802---DtaAdD`).innerText = parseInt(Date.now() / 1e3);
      setTimeout(startTime, 1e3 - new Date() % 1e3);
    }

    document.querySelector(q+`94163802---DtaAdD`).addEventListener(`keyup`, async event => {
      if (event.defaulPrevented) return;
      switch (event.key) {
        case `Enter`: return copyNow(false);
      }
    }, true);

    var returnee = false;

    function copyNow(save=true) {
      var copyText = document.querySelector(q+`94163802---DtaAdD`);
      copyText.innerText = copyText.innerText.replaceAll(`\n`, ``).replaceAll(` `, ``)
      copyText = copyText.innerText;
      const ctime = copyText*1e3, d1 = 1e3*60*60*24, options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      };

      document.querySelector(q+`941631471---Fwl8Ur`).innerText
       = `已複製｢${copyText}｣ (${new Date(ctime).toLocaleTimeString(undefined, options)})`;// copy

      document.querySelector(q+`94163674---_GTw_j`).innerText = `
        ${parseInt(new Date(d1*( returnee?(60-45):(45-14) )+ctime)/1e3)} 
        (${new Date(d1*( returnee?(60-45):(45-14) )+ctime).toLocaleTimeString(undefined, options)})
      `;// 下次登出時間

      document.querySelector(q+`94163738---UoBAHO`).innerText = `
        ${parseInt(new Date(d1*(returnee?60:45)+ctime)/1e3)} 
        (${new Date(d1*(returnee?60:45)+ctime).toLocaleTimeString(undefined, options)})
      `;// 下次回歸時間

       document.querySelector(q+`94163605---q029wX`).innerHTML = `
        ${returnee?`<font color="#f78a2d">45天後`:`兩個禮拜以後`} 
        ${parseInt(new Date(d1*(returnee?45:14)+ctime)/1e3)} 
        (${new Date(d1*(returnee?45:14)+ctime).toLocaleTimeString(undefined, options)})
        <br> ${returnee?`15天前`:`31天前`} 
        ${parseInt(new Date( ctime-d1* (returnee?15:31) )/1e3)} 
        (${new Date( ctime-d1* (returnee?15:31) ).toLocaleTimeString(undefined, options)})
        ${returnee?`</font>`:``}
      `;// 登出時計算

      if(save){
        navigator.clipboard.writeText(copyText);
        // https://github.com/tsayen/dom-to-image#usage
        domtoimage.toBlob(document.querySelector(q+`941632148---bSTMA9`))
          .then(function (blob) {
              window.saveAs(blob, `${copyText}.png`);
          });
      }
    }
    document.querySelector(q+`94163834---lst4oB`).onclick=copyNow;

    document.querySelector(`#returneeGiftsBtn`).addEventListener(`click`, () => {
      if(returnee = !returnee){
        event.target.style.boxShadow = `inset 0px 0px 0px 3px red`;
        document.querySelector(q+`94163605---q029wX`).innerHTML=`<font color="#f78a2d">觸發條件：冒險等階30級以上、45天以上未登入遊戲且60天以上未觸發「歸途贈禮」</font>`;
        document.querySelector(q+`94163570---p3KweJ`).innerHTML=`下次登出時間<br><font color="#f78a2d">(15天後)</font>`;
        document.querySelector(q+`94163706---qa1M2w`).innerHTML=`下次回歸時間<br><font color="#f78a2d">(60天後)</font>`;
        document.querySelector(q+`94163738---UoBAHO`).innerHTML=`🖱️複製後計算<br><font color="red">※登出時計算看</font><font color="#f78a2d">下面</font>`;
      } else {
        event.target.style.boxShadow = `inherit`;
        document.querySelector(q+`94163605---q029wX`).innerHTML=`觸發條件：冒險等階10級以上、14天以上未登入遊戲且45天以上未觸發「星之歸還」`;
        document.querySelector(q+`94163570---p3KweJ`).innerHTML=`下次登出時間<br>(31天後)`;
        document.querySelector(q+`94163706---qa1M2w`).innerHTML=`下次回歸時間<br>(45天後)`;
        document.querySelector(q+`94163738---UoBAHO`).innerHTML=`🖱️複製後計算<br><font color="red">※登出時計算看</font><font color="#627a90">下面</font>`;
      }
      document.querySelector(q+`941631471---Fwl8Ur`).innerHTML=`<a href="https://github.com/twjmy" target="_blank">作者<i class="fa-brands fa-fw fa-github"></i>twjmy</a> 媒體資源皆取自<a href="https://hoyo.link/dBOiFLAL" target="_blank">©原神官方先行展示網頁</a>`;
      document.querySelector(q+`94163674---_GTw_j`).innerHTML=`🖱️複製後計算<br><font color="red">※觸發時計算看</font>上面`;
    }, true);

    screen.orientation.lock('landscape');
  </script>
</body>

</html>
